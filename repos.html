<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <script src="lib/VSS.SDK.min.js"></script>
    <script type="text/javascript">
        // Example from: https://docs.microsoft.com/en-us/azure/devops/extend/develop/ui-controls/configure?view=azure-devops
        VSS.init({
            explicitNotifyLoaded: true,
            usePlatformScripts: true,
            usePlatformStyles: true       
        });

        VSS.require(["VSS/Controls", "VSS/Controls/Grids"], (Controls, Grids) => {
            var grid = Controls.create(Grids.Grid, $("#grid-container"), {
                height: "1000px",
                columns: [
                    { text: "Repository", index: "Repository", width: 400 },
                    { text: "Required Reviewers Policy", index: "HasRequiredReviewerPolicy", width: 250 }
                ]
            });

            // Example from: https://docs.microsoft.com/en-us/azure/devops/extend/develop/data-storage?view=azure-devops#data-collections-of-documents-storage
            VSS.getService(VSS.ServiceIds.ExtensionData).then(function(dataService) {
                var context = VSS.getWebContext();

                // Old style Q promises (as used by VSS SDK): https://github.com/kriskowal/q/wiki/API-Reference#core-promise-methods
                dataService
                    .getDocument("GitRepositories", context.project.name)
                    .then(doc => grid.setDataSource(doc.reports), err => document.getElementById("error").innerText = err.message)
                    .then(() => VSS.notifyLoadSucceeded());
            });
        });
    </script>

    <style>
        .info {
            margin: 1em;
        }
    </style>
</head>
<body>        
    <div class="info">
        <h1>Rabobank DevOps Security Blueprint: Repositories</h1>
        <h2>⚠ This page is work in progress ⚠</h2>
        <p>For feedback or questions, please contact the TAS/Electron team.</p>
        <p>See <a href="https://confluence.dev.rabobank.nl/pages/viewpage.action?pageId=119243814#ApplyDevOpsSecurityBlueprintCI/CDprinciples-Repositories" target="_blank">this</a> page for more information on the <em>how & why</em> of branching policies with Azure Repos.</p>

        <div id="error" class="error"></div>
    </div>
    <div id="grid-container"></div>
</body>
</html>